# Kubeconfig Plugin for Arcaflow

The Kubeconfig plugin is used to input a kubernetes or openshift kubeconfig file and parse and extract components of the kubeconfig file
such as cluster name, user, server url, client certificate, client token etc.

The plugin expects a kubeconfig inputed as a string, as defined in the `InputParams` dataclass in [kubeconfig_plugin.py](kubeconfig_plugin.py) file.
You define your test parameters in a YAML file to be passed to the plugin command as shown in [kubeconfig_example.yaml](kubeconfig_example.yaml).

## To test:

In order to run the [kubeconfig plugin](kubeconfig_plugin.py) run the following steps:

### Containerized
1. Clone this repository
2. Create the container with `docker build -t arca-kubeconfig -f Dockerfile`
3. Run `cat kubeconfig_example.yaml | docker run -i arca-kubeconfig -f -` to run the plugin


### Native

1. Clone this repository
2. Create a `venv` in the current directory with `python3 -m venv $(pwd)/venv`
3. Activate the `venv` by running `source venv/bin/activate`
4. Run `pip install poetry`
5. Run `poetry install`
6. Run `./kubeconfig_plugin.py -f kubeconfig_example.yaml ` to run the plugin


## Image Building

You can change this plugin's image version tag in
`.github/workflows/carpenter.yaml` by editing the
`IMAGE_TAG` variable, and pushing that change to the
branch designated in that workflow.

<!-- Autogenerated documentation by arcaflow-docsgen -->
## kubeconfig plugin (`kubeconfig`)

Inputs a kubeconfig, parses it and extracts the kubernetes cluster details

### Input

<table><tbody>
<tr><th>Type:</th><td><code>scope</code></td><tr><th>Root object:</th><td>InputParams</td></tr>
<tr><th>Properties</th><td><details><summary>kubeconfig (<code>string</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>kubeconfig</td></tr><tr><th>Description:</th><td>input kubeconfig string</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td><tr><th>Minimum length:</th><td>1</td></tr></tbody></table>
            </details></td></tr>
<tr><td colspan="2"><details><summary><strong>Objects</strong></summary><details><summary>InputParams (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>kubeconfig (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>kubeconfig</td></tr><tr><th>Description:</th><td>input kubeconfig string</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td><tr><th>Minimum length:</th><td>1</td></tr></tbody></table>
        </details></td></tr>
</tbody></table>
        </details></details></td></tr>
</tbody></table>

### Outputs


#### error

<table><tbody>
<tr><th>Type:</th><td><code>scope</code></td><tr><th>Root object:</th><td>ErrorOutput</td></tr>
<tr><th>Properties</th><td><details><summary>error (<code>string</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>Failure Error</td></tr><tr><th>Description:</th><td>Reason for failure</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
            </details></td></tr>
<tr><td colspan="2"><details><summary><strong>Objects</strong></summary><details><summary>ErrorOutput (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>error (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Failure Error</td></tr><tr><th>Description:</th><td>Reason for failure</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details></td></tr>
</tbody></table>
        </details></details></td></tr>
</tbody></table>

#### success

<table><tbody>
<tr><th>Type:</th><td><code>scope</code></td><tr><th>Root object:</th><td>SuccessOutput</td></tr>
<tr><th>Properties</th><td><details><summary>connection (<code>reference[Connection]</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>Kubernetes connection</td></tr><tr><th>Description:</th><td>Kubernetes connection confirmation.</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[Connection]</code></td><tr><th>Referenced object:</th><td>Connection</td></tr></tbody></table>
            </details></td></tr>
<tr><td colspan="2"><details><summary><strong>Objects</strong></summary><details><summary>Connection (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>bearerToken (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Secret token of the user/service account</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>cacert (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>CA certificate in PEM format</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>cert (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Client cert data in PEM format</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>host (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Server</td></tr><tr><th>Description:</th><td>Kubernetes API URL</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>key (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Client key in PEM format</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>password (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Password to authenticate with.</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>path (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Kubernetes API path</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>serverName (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Server name to verify TLS certificate against.</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details><details><summary>username (<code>string</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Username to authenticate with.</td></tr><tr><th>Required:</th><td>No</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details></td></tr>
</tbody></table>
        </details><details><summary>SuccessOutput (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>connection (<code>reference[Connection]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Kubernetes connection</td></tr><tr><th>Description:</th><td>Kubernetes connection confirmation.</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[Connection]</code></td><tr><th>Referenced object:</th><td>Connection</td></tr></tbody></table>
        </details></td></tr>
</tbody></table>
        </details></details></td></tr>
</tbody></table>
<!-- End of autogenerated documentation -->
